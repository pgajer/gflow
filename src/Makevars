# ---- Include paths
PKG_CPPFLAGS = -I. -IANN
PKG_CPPFLAGS += -I../inst/include/gflow
PKG_CPPFLAGS += -I../inst/include -DR_NO_REMAP
#PKG_CPPFLAGS += -DEIGEN_DONT_VECTORIZE -DEIGEN_DONT_PARALLELIZE
# Only disable parallelization on problematic platforms
ifeq ($(OS),Windows_NT)
    PKG_CPPFLAGS += -DEIGEN_DONT_PARALLELIZE
else
    # Enable Eigen parallelization on Unix-like systems
    PKG_CPPFLAGS += -DEIGEN_USE_OPENMP
endif
PKG_CPPFLAGS += -D_Alignof=__alignof__
# Neutralize ANN's DLL decorations (harmless on non-Windows too)
PKG_CPPFLAGS += -DDLL_API=

# Force-include Eigen config before any Eigen headers
PKG_CPPFLAGS += -include ../inst/include/gflow/eigen_config.hpp

# ---- C++ standard / OpenMP
CXX_STD      = CXX17
# PKG_CXXFLAGS = $(SHLIB_OPENMP_CXXFLAGS)
# PKG_LIBS     = $(SHLIB_OPENMP_CXXFLAGS) $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

# temprary OpenMP fix
# Development: suppress warnings (remove/review before CRAN submission) ;;;
PKG_CXXFLAGS = $(SHLIB_OPENMP_CXXFLAGS) -fopenmp -Wno-class-memaccess -Wno-psabi -Wno-pedantic
# PKG_CFLAGS   = -Wno-pedantic $(C_VISIBILITY)
PKG_LIBS     = $(SHLIB_OPENMP_CXXFLAGS) -fopenmp $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

# ---- Sources
SOURCES_CPP  = $(wildcard *.cpp)
SOURCES_C    = $(wildcard *.c)
ANN_SOURCES  = $(wildcard ANN/*.cpp)

# ---- Objects
OBJECTS = $(SOURCES_CPP:.cpp=.o) $(SOURCES_C:.c=.o) $(ANN_SOURCES:.cpp=.o)

# ---- Build target
$(SHLIB): $(OBJECTS)
