% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/uggmalo.R
\name{uggmalo.bayesian.bootstrap.with.uncertainty}
\alias{uggmalo.bayesian.bootstrap.with.uncertainty}
\title{Bayesian Bootstrap with Uncertainty for UGGMALO Predictions}
\usage{
uggmalo.bayesian.bootstrap.with.uncertainty(
  perm.results,
  true.predictions,
  graph,
  n.bootstrap = 1000L,
  n.cores = 14L
)
}
\arguments{
\item{perm.results}{Numeric matrix where each row corresponds to a vertex
and each column contains predictions from a permutation run. Dimensions
should be (number of vertices x number of permutations).}

\item{true.predictions}{Numeric vector of original UGGMALO predictions
for each vertex. Length must match the number of rows in
\code{perm.results}.}

\item{graph}{List containing graph structure with required components:
\describe{
\item{pruned_adj_list}{Adjacency list representation of the graph
(list of integer vectors)}
\item{pruned_dist_list}{List of numeric vectors containing edge
weights/distances}
}}

\item{n.bootstrap}{Integer. Number of bootstrap iterations. Must be
positive. Default: 1000}

\item{n.cores}{Integer. Number of CPU cores to use for parallel
processing. Default: 14}
}
\value{
A list of class "uggmalo_bootstrap" containing:
\item{ci.lower}{Numeric vector of lower bounds of \eqn{95\%} credible intervals}
\item{ci.upper}{Numeric vector of upper bounds of \eqn{95\%} credible intervals}
\item{bootstrap.distribution}{Matrix of bootstrap estimates where each
column represents one bootstrap iteration (vertices x iterations)}
}
\description{
\strong{Note: This is an experimental function and may produce errors under certain conditions.
Use with caution and please report issues.}

Combines Bayesian bootstrap with permutation-based uncertainty estimation
for UGGMALO predictions on a graph. This function accounts for both the
uncertainty in p-value estimation from permutation tests and the spatial
structure of the data.

The function performs these steps:
\enumerate{
\item Generates Dirichlet weights for Bayesian bootstrap
\item Resamples from permutation distributions to account for p-value
uncertainty
\item Applies spatial smoothing using UGGMALO to account for graph
structure
\item Computes credible intervals from the bootstrap distribution
}
}
\section{Known Issues}{

This function currently fails with the error "Reference vertex not found in path vertices"
(line 1944 in centered_paths.cpp). This is a known bug that will be addressed in future releases.
}

\examples{
\dontrun{
# WARNING: This is an experimental function with known issues
# The following example demonstrates the intended usage but currently fails
# with error: "Reference vertex not found in path vertices"

if (requireNamespace("foreach", quietly = TRUE) &&
    requireNamespace("doParallel", quietly = TRUE)) {

  # Create example data
  n.vertices <- 20
  n.perms <- 100

  # Simulated permutation results
  perm.results <- matrix(rnorm(n.vertices * n.perms),
                         nrow = n.vertices, ncol = n.perms)

  # True predictions
  true.predictions <- rnorm(n.vertices)

  # Simple graph structure
  graph <- list(
    pruned_adj_list = lapply(1:n.vertices, function(i) {
      # Simple chain graph
      if (i == 1) c(2L)
      else if (i == n.vertices) c(i - 1L)
      else c(i - 1L, i + 1L)
    }),
    pruned_dist_list = lapply(1:n.vertices, function(i) {
      if (i == 1) c(1.0)
      else if (i == n.vertices) c(1.0)
      else c(1.0, 1.0)
    })
  )

  # Run bootstrap (with fewer iterations for example)
  # NOTE: This currently fails with a known bug
  results <- uggmalo.bayesian.bootstrap.with.uncertainty(
    perm.results = perm.results,
    true.predictions = true.predictions,
    graph = graph,
    n.bootstrap = 100,
    n.cores = 2
  )

  # Plot credible intervals (if successful)
  plot(1:n.vertices, true.predictions, pch = 19,
       ylim = range(c(results$ci.lower, results$ci.upper)),
       xlab = "Vertex", ylab = "Prediction",
       main = "UGGMALO Predictions with 95\% Credible Intervals")
  arrows(1:n.vertices, results$ci.lower,
         1:n.vertices, results$ci.upper,
         length = 0.05, angle = 90, code = 3)
}
}

}
\seealso{
\code{\link{uggmalo}}
}
