% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/two_factor_analysis.R
\name{analyze.weighted.cst}
\alias{analyze.weighted.cst}
\title{Time-Weighted CST Analysis for Binary Outcomes}
\usage{
analyze.weighted.cst(
  x,
  y,
  subj.ids,
  time.points = NULL,
  pos.label = "sPTB",
  neg.label = "TB"
)
}
\arguments{
\item{x}{vector of CST measurements (factor or character), must be
ordered chronologically within each subject}

\item{y}{binary outcome vector, must be constant within each subject}

\item{subj.ids}{vector of subject identifiers, same length as \code{x}}

\item{time.points}{optional numeric vector of time points for each
measurement. If NULL, assumes equal intervals. Must be chronologically
ordered within each subject}

\item{pos.label}{character, label for positive outcome (default: "sPTB")}

\item{neg.label}{character, label for negative outcome (default: "TB")}
}
\value{
A list containing:
\describe{
\item{weighted_proportions}{matrix where rows are subjects and columns
are CSTs. Values represent the proportion of time spent in each CST}
\item{summary}{data frame with columns:
\itemize{
\item CST: Community State Type identifier
\item median_case: Median time proportion in CST for positive outcome group
\item median_control: Median time proportion in CST for negative outcome group
\item p_value: P-value from Wilcoxon rank-sum test
}}
\item{subject_data}{data frame containing subject IDs and outcomes}
}
}
\description{
Performs time-weighted analysis of Community State Types (CSTs) in
longitudinal studies where sampling intervals may be irregular. Weights
each CST observation by its duration to accurately represent the time
spent in different microbial states.
}
\details{
The time-weighting algorithm:
\enumerate{
\item For each subject, calculates the duration of each CST period
\item When \code{time.points} is provided:
\itemize{
\item First observation: duration = \code{(time[2] - time[1]) / 2}
\item Middle observations: duration = \code{(time[i+1] - time[i-1]) / 2}
\item Last observation: duration = \code{(time[n] - time[n-1]) / 2}
}
\item When \code{time.points} is NULL, each observation gets equal weight
\item Sums time by CST and divides by total time to get proportions
\item Compares proportions between outcome groups using Wilcoxon tests
}

This approach is particularly useful when:
\itemize{
\item Sampling is irregular (e.g., clinical visits at varying intervals)
\item Some CST states are transient and might be missed with regular sampling
\item The duration of CST states is biologically meaningful
}
}
\note{
\itemize{
\item Time points must be in the same units throughout the dataset
\item The function assumes measurements are ordered chronologically within subjects
\item For regular sampling, the weighted and unweighted approaches will give similar results
}
}
\examples{
\dontrun{
# Example with gestational age time points
set.seed(123)

# Generate data for 20 subjects
subjects <- rep(1:20, each = 5)
weeks <- rep(c(12, 16, 20, 28, 32), 20)  # Gestational weeks

# Simulate CSTs with some subjects more stable than others
csts <- character(100)
for (i in 1:20) {
  if (i <= 10) {  # Stable subjects
    csts[(i-1)*5 + 1:5] <- sample(c("I", "III"), 5, replace = TRUE, prob = c(0.8, 0.2))
  } else {  # Variable subjects
    csts[(i-1)*5 + 1:5] <- sample(c("I", "III", "IV"), 5, replace = TRUE)
  }
}

# Binary outcome
outcomes <- rep(c(rep(0, 10), rep(1, 10)), each = 5)

# Analyze with time weighting
result <- analyze.weighted.cst(
  x = csts,
  y = outcomes,
  subj.ids = subjects,
  time.points = weeks
)

# View results
print(result$summary)

# Visualize distributions
library(ggplot2)
prop_df <- as.data.frame(result$weighted_proportions)
prop_df$outcome <- result$subject_data$outcome
prop_df$subject <- rownames(prop_df)

# Plot CST I proportions by outcome
ggplot(prop_df, aes(x = outcome, y = I)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.1)) +
  labs(y = "Proportion of time in CST I",
       title = "Time-weighted CST proportions by outcome")
}

}
\references{
Gajer P, et al. (2012). Temporal dynamics of the human vaginal microbiota.
Science Translational Medicine, 4(132), 132ra52.
}
\seealso{
\code{\link{summarize.and.test.cst}} for unweighted analysis approaches
}
