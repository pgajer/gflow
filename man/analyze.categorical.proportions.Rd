% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/two_factor_analysis.R
\name{analyze.categorical.proportions}
\alias{analyze.categorical.proportions}
\title{Analyze Categorical Proportions with Mixed Effects Support}
\usage{
analyze.categorical.proportions(
  x,
  y,
  subj.ids = NULL,
  pos.label = "sPTB",
  neg.label = "TB",
  digits = 2
)
}
\arguments{
\item{x}{factor or coercible to factor, the categorical grouping variable
(e.g., community state types)}

\item{y}{binary variable (factor, logical, or numeric 0/1) representing
the outcome of interest}

\item{subj.ids}{optional factor or coercible to factor, subject identifiers
for repeated measures analysis. If provided, mixed effects models will
be fitted}

\item{pos.label}{character, label for the positive/case level of the
binary outcome (default: "sPTB")}

\item{neg.label}{character, label for the negative/control level of the
binary outcome (default: "TB")}

\item{digits}{integer, number of decimal places for numerical outputs
(default: 2)}
}
\value{
A list containing:
\describe{
\item{prop.test.mat}{matrix with columns for counts, proportions,
relative proportions, confidence intervals, and p-values. If
\code{subj.ids} is provided, includes mixed effects estimates}
\item{contingency}{contingency table of x vs y}
\item{overall.prop}{overall proportion of positive outcomes}
\item{latex.caption}{formatted LaTeX caption describing the analysis}
\item{model}{if mixed effects analysis was performed, the fitted
glmer model object; NULL otherwise}
}
}
\description{
Performs comprehensive analysis of proportions across categorical groups,
with optional support for repeated measures using mixed effects models.
Calculates confidence intervals, relative proportions, and performs
appropriate statistical tests.
}
\details{
The function performs different analyses based on whether subject IDs are provided:

\strong{Without subject IDs:}
\itemize{
\item Calculates proportions for each group
\item Performs one-sample proportion tests against the overall proportion
\item Computes 95\\% confidence intervals
\item Calculates relative proportions compared to overall rate
}

\strong{With subject IDs (mixed effects):}
\itemize{
\item Fits a generalized linear mixed model with random intercepts for subjects
\item Handles convergence issues by trying multiple optimizers
\item Computes model-based confidence intervals and p-values
\item Falls back to simple proportions if model fitting fails
}
}
\note{
For mixed effects models, the function requires the \pkg{lme4} package.
If convergence issues occur, the function will attempt multiple optimizers
before falling back to simple proportion calculations.
}
\examples{
\dontrun{
# Simple analysis without repeated measures
set.seed(123)
cst <- factor(sample(c("I", "II", "III", "IV"), 200, replace = TRUE))
outcome <- rbinom(200, 1, c(0.1, 0.3, 0.2, 0.4)[as.numeric(cst)])

result <- analyze.categorical.proportions(
  x = cst,
  y = outcome,
  pos.label = "Case",
  neg.label = "Control"
)

# Analysis with repeated measures
subjects <- factor(rep(1:50, each = 4))
cst_repeated <- factor(sample(c("I", "II", "III", "IV"), 200, replace = TRUE))
outcome_repeated <- rbinom(200, 1, 0.3)

result_mixed <- analyze.categorical.proportions(
  x = cst_repeated,
  y = outcome_repeated,
  subj.ids = subjects
)
}

}
\seealso{
\code{\link[lme4]{glmer}} for mixed effects model details
}
