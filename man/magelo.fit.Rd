% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/magelo.R
\name{magelo.fit}
\alias{magelo.fit}
\title{Core Fitting Function for MAGELO (Model Averaged Grid-based Epsilon LOwess)}
\usage{
magelo.fit(
  bw,
  degree,
  x,
  y,
  xgrid,
  nn.i,
  nn.d,
  min.K = 15,
  n.C.itr = 0,
  C = 6,
  stop.C.itr.on.min = TRUE,
  n.BB = 0,
  get.BB.gpredictions = FALSE,
  get.BB.predictions = FALSE,
  get.gpredictions.CrI = FALSE,
  get.predictions.CrI = TRUE,
  level = 0.95,
  nn.kernel = "epanechnikov",
  y.binary = FALSE,
  n.perms = 0
)
}
\arguments{
\item{bw}{Numeric specifying bandwidth (radius of disk neighborhood)}

\item{degree}{Integer (0, 1, or 2) specifying polynomial degree:
- 0: weighted mean regression
- 1: local linear regression (y ~ x)
- 2: local quadratic regression (y ~ poly(x, 2))}

\item{x}{Numeric vector of predictor values}

\item{y}{Numeric vector of response values, must be same length as x}

\item{xgrid}{Numeric vector of uniformly spaced grid points spanning range(x)}

\item{nn.i}{Integer matrix (n_grid x K) of indices for x neighbors of each grid point}

\item{nn.d}{Numeric matrix (n_grid x K) of distances to x neighbors of each grid point}

\item{min.K}{Integer specifying minimum number of points required in each local neighborhood}

\item{n.C.itr}{Integer specifying number of Cleveland's iterative reweighting steps}

\item{C}{Numeric scaling factor for residuals in robust fitting.
Higher values reduce influence of outliers}

\item{stop.C.itr.on.min}{Logical; if TRUE, stop iterations when improvements in
fitted values become negligible}

\item{n.BB}{Integer specifying number of Bayesian bootstrap iterations}

\item{get.BB.gpredictions}{Logical; if TRUE, return matrix of bootstrap estimates at grid points}

\item{get.BB.predictions}{Logical; if TRUE, return matrix of bootstrap estimates at x}

\item{get.gpredictions.CrI}{Logical; if TRUE, compute credible intervals at grid points}

\item{get.predictions.CrI}{Logical; if TRUE, compute credible intervals at x}

\item{level}{Numeric between 0 and 1 specifying credible interval level}

\item{nn.kernel}{Character string specifying kernel function:
"epanechnikov", "triangular", "tr.exponential", or "normal"}

\item{y.binary}{Logical; if TRUE, treat y as binary outcome}

\item{n.perms}{Integer specifying number of y permutations for p-value calculation}
}
\value{
A list containing:
\itemize{
\item x: Input predictor values
\item y: Input response values
\item xgrid: Grid points
\item max.K: Maximum number of neighbors used for each point
\item gpredictions: Fitted values at grid points
\item predictions: Fitted values at x
\item BB.predictions: Bootstrap estimates at x (if requested)
\item BB.gpredictions: Bootstrap estimates at grid points (if requested)
\item BB.dgpredictions: Bootstrap derivatives at grid points (if requested)
\item gpredictions.CrI: Credible intervals at grid points (if requested)
\item predictions.CrI: Credible intervals at x (if requested)
\item beta: Model coefficients at each grid point
}
}
\description{
Internal fitting function for MAGELO that performs local polynomial regression using
pre-computed nearest neighbor information. Supports weighted mean (degree 0), local linear
(degree 1), and local quadratic (degree 2) regression with optional robust fitting via
iterative reweighting and uncertainty estimation via Bayesian bootstrap.
}
\note{
This is an internal function called by magelo() after bandwidth optimization.
It should not typically be called directly unless you have pre-computed nearest
neighbor information and know the appropriate bandwidth.
}
\section{Robust Fitting Parameters}{

The robust fitting procedure implements Cleveland's iterative reweighting algorithm to
reduce the influence of outliers. The \code{n.C.itr} parameter controls the maximum number
of reweighting iterations, while \code{C} determines how aggressively outliers are
downweighted. Setting \code{stop.C.itr.on.min = TRUE} enables early stopping when the
algorithm converges, saving computation time without sacrificing accuracy.
}

\section{Uncertainty Estimation}{

Uncertainty quantification is performed using Bayesian bootstrap, which generates posterior
distributions for fitted values by resampling with exponential weights. The \code{n.BB}
parameter controls the number of bootstrap samples. Credible intervals can be computed at
both the original data points and grid points. The bootstrap estimates themselves can also
be returned for custom uncertainty analyses.
}

