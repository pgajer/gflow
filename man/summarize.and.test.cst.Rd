% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/two_factor_analysis.R
\name{summarize.and.test.cst}
\alias{summarize.and.test.cst}
\title{Summarize and Test CST Patterns with Binary Outcomes}
\usage{
summarize.and.test.cst(
  x,
  y,
  subj.ids,
  pos.label = "sPTB",
  neg.label = "TB",
  summary.method = c("most_frequent", "proportions")
)
}
\arguments{
\item{x}{factor or character vector of CST measurements, converted to
factor if necessary}

\item{y}{binary outcome vector that must be constant within each subject.
Can be logical, numeric (0/1), or factor}

\item{subj.ids}{vector of subject identifiers corresponding to CST
measurements. Must be same length as \code{x}}

\item{pos.label}{character, label for positive/case outcome
(default: "sPTB")}

\item{neg.label}{character, label for negative/control outcome
(default: "TB")}

\item{summary.method}{character, method for summarizing repeated CSTs.
Must be either "most_frequent" (use each subject's modal CST) or
"proportions" (calculate time spent in each CST). Default: "most_frequent"}
}
\value{
A list whose structure depends on \code{summary.method}:

If \code{summary.method = "most_frequent"}:
\describe{
\item{prop.test.mat}{matrix of proportion test results for modal CSTs}
\item{contingency}{contingency table of modal CSTs vs outcome}
\item{overall.prop}{overall proportion of positive outcome}
\item{latex.caption}{LaTeX caption for results table}
}

If \code{summary.method = "proportions"}:
\describe{
\item{proportions}{matrix where rows are subjects and columns are CSTs,
values are percentage of measurements in each CST}
\item{tests}{list of Wilcoxon test results comparing CST proportions
between outcome groups}
\item{summary}{data frame with median proportions by outcome group
and p-values for each CST}
}
}
\description{
Analyzes the relationship between Community State Types (CSTs) and binary
outcomes in longitudinal data where subjects have multiple CST measurements
but a single, constant outcome. Provides two methods for summarizing
repeated CST measurements before testing.
}
\details{
This function addresses the challenge of analyzing longitudinal microbiome
data where the outcome of interest (e.g., preterm birth) is measured once
per subject but microbiome composition (CST) is measured multiple times.

The "most_frequent" method identifies each subject's predominant CST and
performs standard proportion tests. The "proportions" method calculates
how much time each subject spends in each CST and uses Wilcoxon tests
to compare these proportions between outcome groups.
}
\note{
This function assumes that the outcome is constant within subjects.
If outcomes vary within subjects, consider alternative approaches or
time-to-event analyses.
}
\examples{
\dontrun{
# Simulated longitudinal CST data
set.seed(123)
n_subjects <- 50
n_timepoints <- 5

# Generate subject IDs and CSTs
subj_ids <- rep(1:n_subjects, each = n_timepoints)
csts <- sample(c("I", "II", "III", "IV"), n_subjects * n_timepoints,
               replace = TRUE, prob = c(0.4, 0.3, 0.2, 0.1))

# Binary outcome (constant per subject)
outcomes <- rep(rbinom(n_subjects, 1, 0.3), each = n_timepoints)

# Analyze using most frequent CST
result_mode <- summarize.and.test.cst(
  x = csts,
  y = outcomes,
  subj.ids = subj_ids,
  summary.method = "most_frequent"
)

# Analyze using CST proportions
result_prop <- summarize.and.test.cst(
  x = csts,
  y = outcomes,
  subj.ids = subj_ids,
  summary.method = "proportions"
)

print(result_prop$summary)
}

}
\seealso{
\code{\link{analyze.weighted.cst}} for time-weighted CST analysis
}
